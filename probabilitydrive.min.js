/*!
  * probabilitydrive.js
  * (c) 2014 James Barwell, http://jamesbarwell.co.uk
  * https://github.com/JamesBarwell/probabilitydrive.js
  * license MIT
  */
(function(e,t){typeof define=="function"&&define.amd?define([],t):e.probabilitydrive=t()})(this,function(){function e(){this.currentUrl,this.store={},this.routeUrls=[],this.blacklistUrls=[],this.countThreshold=0}function t(e,t,n){n===undefined&&(n=this.countThreshold);for(var r in this.store[e]){var i=this.store[e][r];if(n&&i.count<n)continue;if(!1===t.call(this,i,r))return}}function n(e){if(i(e,this.blacklistUrls))return;var n=i(e,this.routeUrls);n&&(e=n),this.store[this.currentUrl]=this.store[this.currentUrl]||[];var s=!1;t.call(this,this.currentUrl,function(t,n){t.url===e&&(s=!0,t.count++)},0),s||this.store[this.currentUrl].push({url:e,count:1,probability:0}),r.call(this,e)}function r(e){if(!this.store[e])return;var n=0;t.call(this,e,function(e,t){n+=e.count},0),t.call(this,e,function(e,t){e.probability=e.count/n},0),this.store[e].sort(function(e,t){return e.count<t.count})}function i(e,t){var n=o(e,"/");for(var r=0;r<t.length;r++){var i=t[r];if(s(n,i))return"/"+i.join("/")}return!1}function s(e,t){for(var n=0;n<t.length;n++){if(!e[n]||t[n]!==e[n]&&t[n].indexOf(":")===-1)break;return!0}return!1}function o(e,t){return e=e.charAt(0)!==t?e:e.substring(1),e.split("/")}return e.prototype.observe=function(e){return e!==this.currentUrl&&n.call(this,e),this.currentUrl=e,this},e.prototype.determine=function(){var e=0,n=[];return t.call(this,this.currentUrl,function(t){if(e>t.count)return!1;n.push(t.url),e=t.count}),n},e.prototype.percentile=function(e){e/=100;var n=this.store[this.currentUrl];if(!n||!n[0])return[];var r=1/n[0].probability,i=[];return t.call(this,this.currentUrl,function(t,n){if(n!==0&&t.probability*r<e)return!1;i.push(t.url)}),i},e.prototype.probability=function(e){var n=[];return t.call(this,this.currentUrl,function(t,r){if(t.probability<e)return!1;n.push(t.url)}),n},e.prototype.setCountThreshold=function(e){this.countThreshold=e},e.prototype.routes=function(e){for(var t=0;t<e.length;t++)this.routeUrls.push(o(e[t],"/"))},e.prototype.blacklist=function(e){for(var t=0;t<e.length;t++)this.blacklistUrls.push(o(e[t],"/"))},e.prototype.getData=function(){return{currentUrl:this.currentUrl,store:this.store}},e.prototype.setData=function(e){e=e||{},this.currentUrl=e.currentUrl,this.store=e.store||{}},e})