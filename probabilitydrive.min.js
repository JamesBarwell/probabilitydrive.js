/*!
  * probabilitydrive.js
  * (c) 2014 James Barwell, http://jamesbarwell.co.uk
  * https://github.com/JamesBarwell/probabilitydrive.js
  * license MIT
  */
(function(e,t){typeof define=="function"&&define.amd?define([],t):e.probabilitydrive=t()})(this,function(){function e(){this.currentUrl,this.store={},this.routeUrls=[],this.blacklistUrls=[]}function t(e){if(r(e,this.blacklistUrls))return;var t=r(e,this.routeUrls);t&&(e=t),this.store[this.currentUrl]=this.store[this.currentUrl]||[];var n=!1;for(var i in this.store[this.currentUrl])if(this.store[this.currentUrl][i].url===e){n=!0,this.store[this.currentUrl][i].count+=1;break}n||this.store[this.currentUrl].push({url:e,count:1,probability:0})}function n(e){if(!this.store[e])return;var t=this.store[e].reduce(function(e,t){return e+=t.count},0);this.store[e].forEach(function(e){e.probability=e.count/t}),this.store[e].sort(function(e,t){return e.count<t.count})}function r(e,t){var n=s(e,"/");for(var r=0;r<t.length;r++){var o=t[r];if(i(n,o))return"/"+o.join("/")}return!1}function i(e,t){for(var n=0;n<t.length;n++){if(!e[n]||t[n]!==e[n]&&t[n].indexOf(":")===-1)break;return!0}return!1}function s(e,t){return e=e.charAt(0)!==t?e:e.substring(1),e.split("/")}return e.prototype.observe=function(e){return!this.currentUrl||this.currentUrl===e?(this.currentUrl=e,this):(t.call(this,e),n.call(this,this.currentUrl),this.currentUrl=e,this)},e.prototype.determine=function(e){e=e||this.currentUrl;var t=0,n=[];for(var r in this.store[e]){if(!(t<=this.store[e][r].count))break;n.push(this.store[e][r]),t=this.store[e][r].count}return n},e.prototype.percentile=function(e){e/=100;var t=this.store[this.currentUrl],n=t.splice(0,1)[0],r=1/n.probability,i=[n];for(var s in t){var o=t[s];if(!(o.probability*r>=e))break;i.push(o)}return i},e.prototype.threshold=function(e){var t=this.store[this.currentUrl],n=[];for(var r in t){var i=t[r];if(!(i.probability>=e))break;n.push(i)}return n},e.prototype.routes=function(e){for(var t=0;t<e.length;t++)this.routeUrls.push(s(e[t],"/"))},e.prototype.blacklist=function(e){for(var t=0;t<e.length;t++)this.blacklistUrls.push(s(e[t],"/"))},e.prototype.getData=function(){return this.store},e.prototype.setData=function(e){this.store=e},e.prototype.here=e.prototype.observe,e.prototype.next=e.prototype.determine,e})